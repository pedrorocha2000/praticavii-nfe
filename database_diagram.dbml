// Use DBML to define your database structure
// Docs: https://dbml.dbdiagram.io/docs
// Sistema NFe - Estrutura completa do banco de dados

Project sistema_nfe {
  database_type: 'PostgreSQL'
  Note: '''
    Sistema de gerenciamento de Notas Fiscais Eletrônicas
    Desenvolvido em Next.js 14 com PostgreSQL
  '''
}

// =====================================================
// TABELAS GEOGRÁFICAS
// =====================================================

Table paises {
  codpais integer [primary key, increment]
  nomepais varchar(50) [not null]
  siglapais char(2) [not null]
  
  Note: 'Cadastro de países'
}

Table estados {
  codest integer [primary key, increment]
  nomeestado varchar(50) [not null]
  siglaest varchar(4) [not null]
  codpais integer [not null]
  
  Note: 'Estados/províncias dos países'
}

Table cidades {
  codcid integer [primary key, increment]
  nomecidade varchar(100) [not null]
  codest integer [not null]
  
  Note: 'Cidades dos estados'
}

// =====================================================
// TABELA CENTRAL
// =====================================================

Table pessoa {
  codigo integer [primary key, increment]
  tipopessoa char(1) [not null, note: 'F=Física, J=Jurídica']
  nomerazao varchar(100) [not null]
  nomefantasia varchar(100)
  cpfcnpj varchar(20)
  rg_inscricaoestadual varchar(20)
  endereco varchar(150)
  numero varchar(10)
  complemento varchar(50)
  bairro varchar(50)
  cep varchar(10)
  codcid integer
  telefone varchar(20)
  email varchar(50)
  datacadastro date [default: 'CURRENT_DATE']
  
  Note: '''
    Tabela central para pessoas físicas e jurídicas.
    Reutilizada por clientes, fornecedores, transportadoras e funcionários.
  '''
}

// =====================================================
// CADASTROS AUXILIARES
// =====================================================

Table categorias {
  codcategoria integer [primary key, increment]
  nome_categoria varchar(100) [not null, unique]
  
  Note: 'Categorias de produtos'
}

Table marcas {
  codmarca integer [primary key, increment]
  nome_marca varchar(100) [not null, unique]
  
  Note: 'Marcas de produtos'
}

Table unidades_medida {
  codunidade integer [primary key, increment]
  nome_unidade varchar(50) [not null, unique]
  sigla_unidade varchar(10) [not null, unique]
  
  Note: 'Unidades de medida (KG, UN, L, etc.)'
}

Table funcoes_funcionario {
  codfuncao integer [primary key, increment]
  nome_funcao varchar(100) [not null, unique]
  exige_cnh boolean [not null, default: false]
  carga_horaria_semanal integer
  
  Note: 'Funções/cargos dos funcionários'
}

Table formapgto {
  codformapgto integer [primary key, increment]
  descricao varchar(50) [not null]
  
  Note: 'Formas de pagamento (Dinheiro, PIX, Cartão, etc.)'
}

Table cond_pgto {
  codcondpgto integer [primary key, increment]
  descricao varchar(50) [not null]
  juros_perc decimal(5,2) [default: 0]
  multa_perc decimal(5,2) [default: 0]
  desconto_perc decimal(5,2) [default: 0]
  
  Note: 'Condições de pagamento (À vista, 30 dias, etc.)'
}

Table parcelas_contapgto {
  codcondpgto integer [not null]
  numparc integer [not null]
  codformapgto integer
  dias integer
  percentual decimal(5,2)
  
  indexes {
    (codcondpgto, numparc) [pk]
  }
  
  Note: 'Parcelas das condições de pagamento'
}

// =====================================================
// ENTIDADES PRINCIPAIS
// =====================================================

Table clientes {
  codcli integer [primary key, increment]
  codcondpgto integer
  codpessoa integer
  
  Note: 'Clientes da empresa'
}

Table fornecedores {
  codforn integer [primary key, increment]
  codcondpgto integer
  codpessoa integer
  
  Note: 'Fornecedores da empresa'
}

Table transportadoras {
  codtrans integer [primary key, increment]
  codpessoa integer
  
  Note: 'Empresas de transporte'
}

Table funcionarios {
  codfunc integer [primary key, increment]
  departamento varchar(100) [not null]
  data_admissao date [not null]
  salario decimal(10,2) [not null]
  status varchar(20) [default: 'Ativo', note: 'Ativo, Inativo, Afastado, Demitido']
  codfuncao_fk integer [not null]
  numero_cnh varchar(20)
  codpessoa integer
  
  Note: 'Funcionários da empresa (sempre Pessoa Física)'
}

Table produtos {
  codprod integer [primary key, increment]
  nome varchar(100) [not null]
  valorunitario decimal(10,2)
  datacadastro date [default: 'CURRENT_DATE']
  codunidade integer
  codcategoria integer
  codmarca integer
  custo_compra decimal(10,2)
  preco_venda decimal(10,2)
  lucro_percentual decimal(5,2)
  codigo_barras varchar(50) [unique]
  quantidade_estoque decimal(10,3)
  quantidade_minima_estoque decimal(10,3)
  
  Note: 'Produtos da empresa'
}

Table veiculos {
  placa varchar(10) [primary key]
  codtrans integer [not null]
  modelo varchar(50)
  descricao text
  
  Note: 'Veículos das transportadoras'
}

// =====================================================
// RELACIONAMENTOS N:N
// =====================================================

Table produto_forn {
  codprod integer [not null]
  codforn integer [not null]
  
  indexes {
    (codprod, codforn) [pk]
  }
  
  Note: 'Relacionamento N:N entre produtos e fornecedores'
}

Table transp_forn {
  codtrans integer [not null]
  codforn integer [not null]
  
  indexes {
    (codtrans, codforn) [pk]
  }
  
  Note: 'Relacionamento N:N entre transportadoras e fornecedores'
}

// =====================================================
// RELACIONAMENTOS ADICIONAIS (para melhor visualização)
// =====================================================

// Relacionamentos geográficos
Ref: estados.codpais > paises.codpais
Ref: cidades.codest > estados.codest
Ref: pessoa.codcid > cidades.codcid

// Relacionamentos de entidades com pessoa
Ref: clientes.codpessoa > pessoa.codigo
Ref: fornecedores.codpessoa > pessoa.codigo
Ref: transportadoras.codpessoa > pessoa.codigo
Ref: funcionarios.codpessoa > pessoa.codigo

// Relacionamentos de produtos
Ref: produtos.codunidade > unidades_medida.codunidade
Ref: produtos.codcategoria > categorias.codcategoria
Ref: produtos.codmarca > marcas.codmarca

// Relacionamentos de funcionários
Ref: funcionarios.codfuncao_fk > funcoes_funcionario.codfuncao

// Relacionamentos de condições de pagamento
Ref: clientes.codcondpgto > cond_pgto.codcondpgto
Ref: fornecedores.codcondpgto > cond_pgto.codcondpgto
Ref: parcelas_contapgto.codcondpgto > cond_pgto.codcondpgto
Ref: parcelas_contapgto.codformapgto > formapgto.codformapgto

// Relacionamentos de veículos
Ref: veiculos.codtrans > transportadoras.codtrans

// Relacionamentos N:N
Ref: produto_forn.codprod > produtos.codprod
Ref: produto_forn.codforn > fornecedores.codforn
Ref: transp_forn.codtrans > transportadoras.codtrans
Ref: transp_forn.codforn > fornecedores.codforn 